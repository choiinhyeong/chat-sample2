"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[168],{49729:function(e,s,n){n.r(s),n.d(s,{default:function(){return k}});var a=n(66252),o=n(3577);const t=e=>((0,a.dD)("data-v-08936fd9"),e=e(),(0,a.Cn)(),e),l={class:"container flex column"},c={class:"flex row"},i={class:"media-list"},u={key:0,class:"media-block"},r={class:"participant-id"},d=t((()=>(0,a._)("div",{class:"local-container"},null,-1))),v=["id"],p={class:"participant-id"};function m(e,s,n,t,m,h){const w=(0,a.up)("voice-meter"),g=(0,a.up)("remote-video");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",c,[(0,a._)("div",i,[t.localMedia?((0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("div",r,(0,o.zw)(n.userInfo.deptNm)+" "+(0,o.zw)(n.userInfo.lrnerNm)+" "+(0,o.zw)(t.myId),1),d])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.remoteParticipants,((e,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"media-block",key:s,id:e.participant.id},[(0,a._)("div",p,(0,o.zw)(e.participant.lrnerNm)+" "+(0,o.zw)(e.participant.id),1),(0,a.Wm)(w,{level:e.level},null,8,["level"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.videos,((e,s)=>((0,a.wg)(),(0,a.j4)(g,{key:s,autoplay:"",remoteVideo:e},null,8,["remoteVideo"])))),128))],8,v)))),128))])])])}var h=n(69755),w=n(17672),g=n(19832),f=n(2262),_=n(9367),y={name:"LiveConference",props:{accessType:String,userInfo:{type:Object}},components:{voiceMeter:h.Z,remoteVideo:w.Z},setup(e){const s=(0,f.iH)(e.userInfo.channelNo+"-conf"),n=(0,f.iH)(null),o=(0,f.iH)(null),t=(0,f.iH)(null),l=(0,f.iH)([]),c=(0,f.iH)(!1),i=(0,f.iH)(""),u=(0,f.iH)([]),r=(0,f.iH)(-1);let d="localhost:3000",v=(0,_.ZP)(d,{transports:["websocket"],path:"/websocket/system"});const p=()=>{console.log(n.value,"init====>",e.userInfo),null===n.value&&("full-access"===e.accessType?h():setTimeout((()=>{h()}),3e3))};(0,a.bv)((()=>{console.log("mounted===>",n.value),p()})),(0,a.Ah)((()=>{C()}));const m=async()=>{await g.Z.signIn({serviceId:"2022KBH0C8AZ",serviceKey:"2022KBH0C8AZ42PO",secret:"w7kvrnnCNVjBzjdR"})},h=async()=>{await m(),await w(),await y(),await n.value.connect(s.value),i.value=n.value.localParticipant.id,c.value=!0,n.value.publish([o.value]);let a={lrnerNm:e.userInfo.lrnerNm,participantId:n.value.localParticipant.id,confName:s.value,channelNo:e.userInfo.channelNo,dateType:"conf"};v.emit("nowConfAddUser",a),r.value=window.setInterval((()=>{const e=n.value.getRemoteAudioLevels();e.remoteParticipants.forEach((e=>{const s=l.value.find((s=>s.participant.id===e.remoteParticipant.id));let n=parseFloat(e.level.toFixed(3));n>.15&&(n=.15),s.level=n/.15*100}))}),250)};v.on("nowConfAddUser",(e=>{console.log("nowConfAddUser;;;;",e),l.value.forEach((s=>{console.log("participant;;;;",s),s.id===e.participantId&&(s.lrnerNm=e.lrnerNm)}))}));const w=async()=>{o.value=await g.Z.createLocalMedia({audio:!0,video:!0}),console.log(n.value),(0,a.Y3)((async()=>{const e=o.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),u.value=await o.value.getCameraDevices()}))},y=async()=>{n.value=g.Z.createConference(),n.value.on("connected",(e=>{e.remoteParticipants.forEach((async e=>{let s=[];const a=e.getUnsubscribedVideos();if(a.length){const e=a.map((e=>{e.getVideoId()}));s=await n.value.subscribe(e)}console.log("connected;;;;",e),l.value.push({participant:e,videos:s,level:0})}))})),n.value.on("participantEntered",(e=>{l.value.push({participant:e.remoteParticipant,videos:[],level:0})})),n.value.on("participantLeft",(e=>{const s=l.value.findIndex((s=>s.participant.id===e.remoteParticipantId));l.value.splice(s,1)})),n.value.on("remoteVideoPublished",(async s=>{const a=await n.value.subscribe([s.remoteVideo.videoId]);if(a.length){const n=l.value.find((e=>e.participant.id===s.remoteParticipant.id));n&&(n.videos=n.videos.concat(a),n.lrnerNm=e.userInfo.lrnerNm)}})),n.value.on("remoteVideoUnpublished",(e=>{const s=l.value.find((s=>s.participant.id===e.remoteParticipant.id));s&&(s.videos=s.videos.filter((s=>s.videoId!==e.remoteVideo.videoId)))}))},C=async()=>{n.value.disconnect(),o.value.stop(),o.value.video.detach(),o.value=null,t.value&&(t.value.stop(),t.value.video.detach(),t.value=null),c.value=!1,i.value="",l.value=[],window.clearInterval(r.value),r.value=-1,g.Z.signOut()},b=async()=>{t.value=await g.Z.createLocalScreen({audio:!0,video:!0}),t.value.video.setExtraValue("screen");const e=t.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),n.value.publish([t.value])},k=async()=>{t.value.video.detach(),t.value.stop(),n.value.unpublish([t.value]),t.value=void 0};return{confName:s,conf:n,localMedia:o,localScreen:t,remoteParticipants:l,isConnected:c,myId:i,cameraDevices:u,audioCheckInterval:r,onConnect:h,onProvisioning:m,onCreateLocalMedia:w,onCreateLocalScreen:b,onCreateConference:y,onDisConnectConference:C,onDestroyLocalScreen:k}}},C=n(83744);const b=(0,C.Z)(y,[["render",m],["__scopeId","data-v-08936fd9"]]);var k=b},14168:function(e,s,n){n.r(s),n.d(s,{default:function(){return De}});var a=n(66252),o=n(3577),t=n(49963);const l={class:"kb-cloud",id:"kb-cloud"},c={class:"cloud-container",id:"cloud-now"},i={class:"cloud-wrapper"},u={class:"cloud-header"},r={class:"header-column header-title"},d=(0,a._)("h2",{class:"title"},"클라우드",-1),v=[d],p=(0,a._)("div",{class:"badge-now"},"NOW",-1),m=(0,a._)("div",{class:"header-column header-subtitle"},null,-1),h={class:"header-column header-util"},w=(0,a._)("div",{class:"util-status"},null,-1),g={class:"util-my"},f={class:"text"},_={class:"my-avatar"},y={class:"cloud-body"},C={class:"cloud-player"},b={class:"player-main"},k={class:"main-viewport"},I={class:"viewport-header"},S={class:"header-column header-views"},H=(0,a._)("i",{class:"icon-eye"},null,-1),N={class:"text"},T=(0,a._)("div",{class:"header-column header-actions"},[(0,a._)("button",{class:"btn-viewport"},[(0,a._)("i",{class:"icon-viewport"})])],-1),L={class:"viewport-video"},x={key:2,src:"https://zep.us/play/8jd49y",width:"100%",height:"584px"},D={class:"main-actions"},M={key:0,class:"menu-buttons"},P={class:"menu-list"},Z=(0,a._)("i",{class:"icon-menu-lecture"},null,-1),j=(0,a._)("span",{class:"text"},"강의",-1),q=[Z,j],U=(0,a.uE)('<div class="dropdown-target"><div class="dropdown-box"><article class="dropdown-option-group"><h4 class="option-group-title">학습관리</h4><ul class="dropdown-option-list"><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습시작</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">휴식시작</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">휴식종료</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료 취소</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료 확인</a></li></ul></article></div></div>',1),F=(0,a._)("i",{class:"icon-menu-display"},null,-1),z=(0,a._)("span",{class:"text"},"방송",-1),A=[F,z],E=(0,a._)("i",{class:"icon-menu-display"},null,-1),V=(0,a._)("span",{class:"text"},"화상",-1),Q=[E,V],K=(0,a._)("i",{class:"icon-menu-attendance"},null,-1),R=(0,a._)("span",{class:"text"},"ZEP",-1),O=[K,R],Y=(0,a.uE)('<li class="menu-item"><button class="btn-menu"><i class="icon-menu-attendance"></i><span class="text">출석</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-quiz"></i><span class="text">퀴즈・투표</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-event"></i><span class="text">이벤트・쿠폰</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-qna"></i><span class="text">Q&amp;A・공지</span></button></li>',4),B={class:"action-buttons"},W=(0,a._)("button",{class:"btn-reconnect"},[(0,a._)("i",{class:"icon-reconnect"}),(0,a._)("span",{class:"text"},"재접속")],-1),$=(0,a._)("i",{class:"icon-exit"},null,-1),G=(0,a._)("span",{class:"text"},"종료",-1),J=[$,G],X={class:"player-aside"},ee={class:"aside-chat-container"},se={class:"chat-screen"},ne={class:"chat-screen-messages",ref:"chatScreenEl"},ae={class:"chat-write"},oe={class:"chat-write-options"},te=(0,a.uE)('<div class="option-column"><button class="btn-emoji"><i class="icon-emoji"></i></button><button class="btn-file"><i class="icon-file"></i></button></div>',1),le={key:0,class:"option-column"},ce=(0,a._)("i",{class:"icon-menu"},null,-1),ie=[ce],ue={class:"dropdown-target"},re={class:"dropdown-box"},de={class:"dropdown-option-list"},ve={class:"dropdown-option-item"},pe={class:"chat-write-forms"},me=(0,a._)("span",{class:"text"},"전송",-1),he=[me];function we(e,s,n,d,Z,j){const F=(0,a.up)("ChatProfileImage"),z=(0,a.up)("CloudNowTeacherQuestion"),E=(0,a.up)("LiveCast"),V=(0,a.up)("LiveConference"),K=(0,a.up)("ChatMessage");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",c,[(0,a._)("div",i,[(0,a._)("header",u,[(0,a._)("div",r,[(0,a._)("a",{href:"javascript:",onClick:s[0]||(s[0]=(...e)=>d.menuCompHideFunc&&d.menuCompHideFunc(...e))},v),p]),m,(0,a._)("div",h,[w,(0,a._)("div",g,[(0,a._)("span",f,(0,o.zw)(d.userInfo.lrnerNm),1),(0,a._)("div",_,[(0,a.Wm)(F,{target:d.userInfo.lrnerId},null,8,["target"])])])])]),(0,a._)("div",y,[d.showTeacherQstnComp?((0,a.wg)(),(0,a.j4)(z,{key:0})):(0,a.kq)("",!0),(0,a._)("div",C,[(0,a._)("div",b,[(0,a._)("div",k,[(0,a._)("div",I,[(0,a._)("div",S,[H,(0,a._)("span",N,(0,o.zw)(d.connUserCnt),1)]),T]),(0,a._)("div",L,[d.isLiveCastShow?((0,a.wg)(),(0,a.j4)(E,{key:0,"access-type":d.userInfo.accessType,"user-info":d.userInfo},null,8,["access-type","user-info"])):(0,a.kq)("",!0),d.onLiveConfShow?((0,a.wg)(),(0,a.j4)(V,{key:1,style:(0,o.j5)(""+(d.isLiveConfShow?"display:block;":"display:none;")),"access-type":d.userInfo.accessType,"user-info":d.userInfo},null,8,["style","access-type","user-info"])):(0,a.kq)("",!0),d.isIframeShow?((0,a.wg)(),(0,a.iD)("iframe",x)):(0,a.kq)("",!0)])]),(0,a._)("div",D,["full-access"===d.userInfo.accessType?((0,a.wg)(),(0,a.iD)("div",M,[(0,a._)("ul",P,[(0,a._)("li",{class:(0,o.C_)(["menu-item dropdown",{"is-active":d.showLectureMenu}])},[(0,a._)("button",{class:(0,o.C_)(["btn-menu",{"is-active":d.showLectureMenu}]),onClick:s[1]||(s[1]=e=>d.toggleMenu("lecture"))},q,2),U],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isLiveCastShow?"is-active":""))},[(0,a._)("button",{onClick:s[2]||(s[2]=e=>d.connectCastFunc("cast")),class:"btn-menu"},A)],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isLiveConfShow?"is-active":""))},[(0,a._)("button",{onClick:s[3]||(s[3]=e=>d.connectCastFunc("conf")),class:"btn-menu"},Q)],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isIframeShow?"is-active":""))},[(0,a._)("button",{onClick:s[4]||(s[4]=e=>d.connectCastFunc("zep")),class:"btn-menu"},O)],2),Y])])):(0,a.kq)("",!0),(0,a._)("div",B,[W,(0,a._)("button",{class:"btn-exit",onClick:s[5]||(s[5]=(...e)=>d.sendDisconnect&&d.sendDisconnect(...e))},J)])])]),(0,a._)("div",X,[(0,a._)("div",ee,[(0,a._)("div",se,[(0,a._)("ul",ne,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.msgArr,((e,s)=>((0,a.wg)(),(0,a.j4)(K,{key:s,type:e.type,message:e.message,"lrner-id":e.lrnerId,"lrner-name":e.lrnerNm,"send-date":e.sendDate},null,8,["type","message","lrner-id","lrner-name","send-date"])))),128))],512)]),(0,a._)("div",ae,[(0,a._)("div",oe,[te,"full-access"!==d.userInfo.accessType?((0,a.wg)(),(0,a.iD)("div",le,[(0,a._)("div",{class:(0,o.C_)(["option-menu dropdown",{"is-active":d.showTeacherQstnMenu}])},[(0,a._)("button",{class:"btn-menu",onClick:s[6]||(s[6]=e=>d.toggleMenu("teacher"))},ie),(0,a._)("div",ue,[(0,a._)("div",re,[(0,a._)("ul",de,[(0,a._)("li",ve,[(0,a._)("a",{href:"javascript:",onClick:s[7]||(s[7]=(...e)=>d.showTeacherQstnCompFunc&&d.showTeacherQstnCompFunc(...e)),class:"dropdown-option-link"},"강사님께 질문하기")])])])])],2)])):(0,a.kq)("",!0)]),(0,a._)("div",pe,[(0,a.wy)((0,a._)("input",{type:"text",placeholder:"메시지 입력","onUpdate:modelValue":s[8]||(s[8]=e=>d.inputMessage=e),onKeyup:s[9]||(s[9]=(0,t.D2)(((...e)=>d.sendMessage&&d.sendMessage(...e)),["enter"]))},null,544),[[t.nr,d.inputMessage]]),(0,a._)("button",{class:"btn-write",onClick:s[10]||(s[10]=(...e)=>d.sendMessage&&d.sendMessage(...e))},he)])])])])])])])])])}n(82801);var ge=n(2262),fe=n(9367),_e=n(33907),ye=n(6315),Ce=n(42119),be=n(4252),ke=n(54977),Ie=n(64761),Se=n(4100),He=n(80703),Ne=n(49729),Te={name:"CloudNow",components:{LiveConference:Ne["default"],CloudNowTeacherQuestion:He.Z,LiveCast:Se.Z,ChatProfileImage:Ie.Z,ChatMessage:be.Z},setup(){const e=(0,_e.oR)();let s="";s="localhost:3000";let n=(0,fe.ZP)(s,{transports:["websocket"],path:"/websocket/chat"}),o=(0,fe.ZP)(s,{transports:["websocket"],path:"/websocket/system"});const t=(0,ge.iH)(),l=(0,ge.iH)([]),c=(0,ge.iH)(!1),i=(0,ge.iH)(!1),u=(0,ge.iH)(!1),r=(0,ge.iH)(),d=(0,ge.iH)(!1),v=(0,ge.iH)(!1),p=(0,ge.iH)(!1),m=(0,ge.iH)(!1),h=(0,ge.iH)(""),w=(0,ge.iH)(0);(0,a.bv)((()=>{console.log("onMounted====>",n.connected,",",o.connected),"now"===N.query.cloud?h.value="now":h.value="on",document.body.classList.add("notscroll"),N.query.params?(g.value=JSON.parse(decodeURIComponent(atob(N.query.params))),f()):console.log("재접속 해주세요.")})),(0,a.Ah)((()=>{console.log("onUnmounted====>",n.connected,",",o.connected),(n.connected||o.connected)&&(n.disconnect(),o.disconnect()),d.value=!1,p.value=!1,v.value=!1}));const g=(0,ge.iH)({}),f=()=>{g.value.sendType="",g.value.message="",g.value.messageType="",g.value.socketId="",g.value.socketId2="",g.value.channelNo="channel-now-chat",g.value.accessType="viewer","S017330"===g.value.lrnerId&&(g.value.accessType="full-access"),g.value.isCast=!1,g.value.isConf=!1,n.emit("chat_channel_connection",g.value),o.emit("domSocket_channel_connection",g.value)},_=()=>{void 0!==t.value&&""!==t.value&&(g.value.sendType="message",g.value.message=t.value,t.value="",n.emit("message",g.value))},y=()=>{console.log("sendDisconnect =======> "),g.value.sendType="disconnect",d.value=!1,p.value=!1,v.value=!1,n.disconnect(),o.disconnect()};n.on("chat_channel_connection",(e=>{console.log("chat connection success ========> ",e.socketId),g.value.socketId=e.socketId,S()})),n.on("message",(e=>{console.log("chat messsage===>",e);let s="",n=e.lrnerNm;e.lrnerId===g.value.lrnerId&&(s="my",n="");let a=(0,ke.KG)(e.connectDate,"(A) hh:mm");l.value.push({type:s,message:e.message,lrnerId:e.lrnerId,lrnerNm:n,sendDate:a})})),n.on("disconnect",(e=>{console.log("disconnect ========> ",e),S()})),n.on("disconnectCustom",(e=>{console.log("disconnectCustom ========> ",e)})),o.on("domSocket_channel_connection",(e=>{console.log("domSocket connection success ========> ",e.socketId2),g.value.socketId2=e.socketId2})),o.on("disconnect",(()=>{console.log("domSocket disconnect ========> ")})),o.on("disconnectCustom",(()=>{console.log("domSocket disconnectCustom ========> ")})),o.on("message",(e=>{console.log("domSocket message ========> ",e.messageType),"liveCast"===e.messageType?d.value?d.value=!1:d.value=!0:"liveConf"===e.messageType&&(v.value?v.value=!1:v.value=!0)}));const C=e=>{g.value.sendType="message","cast"===e?(g.value.messageType="liveCast",o.emit("message",g.value),g.value.messageType="liveConf",o.emit("message",g.value)):"conf"===e?p.value?p.value=!1:p.value=!0:"zep"===e&&(m.value?m.value=!1:m.value=!0)},b=e=>{"lecture"===e?c.value=!c.value:"teacher"===e&&(i.value=!i.value)},k=()=>{u.value=!u.value},I=()=>{c.value=!1,i.value=!1,u.value=!1},S=()=>{e.dispatch(`users/${ye.qU}`,g.value.channelNo).then((e=>{console.log("getRedisUsersList====>",e),200===e.status&&console.log("status 200 ==> ",w.value)})).catch((e=>{console.error(e)}))},H=()=>{e.dispatch(`users/${ye.lr}`,localStorage.getItem("info")).then((e=>{e.status})).catch((e=>{console.error(e)}))},N=(0,Ce.yj)(),T=()=>{e.dispatch(`users/${ye.Zv}`,{accTy:"admin",userSn:"65795",lrnerId:"S017347",lrnerNm:"김상민",deptCd:"",deptNm:""}).then((e=>{200===e.status&&(N.params.encrypt=e.data)})).catch((e=>{console.error(e),alert("창을 닫고 재접속 해주세요.")}))};return{inputMessage:t,userInfo:g,chatScreenEl:r,msgArr:l,isLiveCastShow:d,onLiveConfShow:v,isLiveConfShow:p,isIframeShow:m,showLectureMenu:c,showTeacherQstnMenu:i,showTeacherQstnComp:u,connUserCnt:w,sendMessage:_,sendDisconnect:y,getUsersEncryptFunc:T,getUsersDecryptFunc:H,getRedisUsersList:S,connectCastFunc:C,showTeacherQstnCompFunc:k,toggleMenu:b,menuCompHideFunc:I}}},Le=n(83744);const xe=(0,Le.Z)(Te,[["render",we]]);var De=xe}}]);
//# sourceMappingURL=168.ac6d04a4.js.map