"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[672],{47528:function(e,s,n){n.r(s),n.d(s,{default:function(){return k}});var a=n(66252),o=n(3577);const t=e=>((0,a.dD)("data-v-3711e481"),e=e(),(0,a.Cn)(),e),l={class:"container flex column"},c={class:"flex row"},i={class:"media-list"},u={key:0,class:"media-block"},r={class:"participant-id"},d=t((()=>(0,a._)("div",{class:"local-container"},null,-1))),v=["id"],p={class:"participant-id"};function m(e,s,n,t,m,h){const w=(0,a.up)("voice-meter"),g=(0,a.up)("remote-video");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",c,[(0,a._)("div",i,[t.localMedia?((0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("div",r,(0,o.zw)(t.userInfo.deptNm)+" "+(0,o.zw)(t.userInfo.lrnerNm)+" "+(0,o.zw)(t.myId),1),d])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.remoteParticipants,((e,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"media-block",key:s,id:e.participant.id},[(0,a._)("div",p,(0,o.zw)(e.participant.lrnerNm)+" "+(0,o.zw)(e.participant.id),1),(0,a.Wm)(w,{level:e.level},null,8,["level"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.videos,((e,s)=>((0,a.wg)(),(0,a.j4)(g,{key:s,autoplay:"",controls:"",remoteVideo:e},null,8,["remoteVideo"])))),128))],8,v)))),128))])])])}n(82801);var h=n(69755),w=n(94572),g=n(19832),_=n(2262),y=n(42119),f={name:"LiveConference",components:{voiceMeter:h.Z,remoteVideo:w.Z},setup(){const e=(0,_.iH)(),s=(0,_.iH)(null),n=(0,_.iH)(null),o=(0,_.iH)(null),t=(0,_.iH)([]),l=(0,_.iH)(!1),c=(0,_.iH)(""),i=(0,_.iH)([]),u=(0,_.iH)(-1),r=(0,_.iH)({}),d=(0,y.yj)(),v=()=>{r.value=JSON.parse(decodeURIComponent(atob(d.query.params))),e.value=r.value.channelNo+"conf",null===s.value&&("full-access"===r.value.accessType?m():setTimeout((()=>{m()}),3e3))};(0,a.bv)((()=>{console.log("mounted===>",s.value),v()})),(0,a.Ah)((()=>{f()}));const p=async()=>{await g.Z.signIn({serviceId:"2022KBH0C8AZ",serviceKey:"2022KBH0C8AZ42PO",secret:"w7kvrnnCNVjBzjdR"})},m=async()=>{await p(),await h(),await w(),await s.value.connect(e.value),c.value=s.value.localParticipant.id,l.value=!0,s.value.publish([n.value]),u.value=window.setInterval((()=>{const e=s.value.getRemoteAudioLevels();e.remoteParticipants.forEach((e=>{const s=t.value.find((s=>s.participant.id===e.remoteParticipant.id));let n=parseFloat(e.level.toFixed(3));n>.15&&(n=.15),s.level=n/.15*100}))}),250)},h=async()=>{n.value=await g.Z.createLocalMedia({audio:!0,video:!0}),console.log(s.value),(0,a.Y3)((async()=>{const e=n.value.video.attach();e.className="local-video",e.style.width="100%",e.muted=!0,e.autoplay=!0,e.controls=!0,document.querySelector(".local-container").appendChild(e),i.value=await n.value.getCameraDevices()}))},w=async()=>{s.value=g.Z.createConference(),s.value.on("connected",(e=>{e.remoteParticipants.forEach((async e=>{let n=[];const a=e.getUnsubscribedVideos();if(a.length){const e=a.map((e=>{e.getVideoId()}));n=await s.value.subscribe(e)}t.value.push({participant:e,videos:n,level:0}),console.log("connected participant;;;;",e),console.log("connected remoteParticipants;;;;",t.value)}))})),s.value.on("participantEntered",(e=>{t.value.push({participant:e.remoteParticipant,videos:[],level:0}),console.log("participantEntered remoteParticipants;;;;",t.value)})),s.value.on("participantLeft",(e=>{const s=t.value.findIndex((s=>s.participant.id===e.remoteParticipantId));t.value.splice(s,1)})),s.value.on("remoteVideoPublished",(async e=>{const n=await s.value.subscribe([e.remoteVideo.videoId]);if(n.length){const s=t.value.find((s=>s.participant.id===e.remoteParticipant.id));s&&(s.videos=s.videos.concat(n),s.lrnerNm=r.value.lrnerNm)}})),s.value.on("remoteVideoUnpublished",(e=>{const s=t.value.find((s=>s.participant.id===e.remoteParticipant.id));s&&(s.videos=s.videos.filter((s=>s.videoId!==e.remoteVideo.videoId)))}))},f=async()=>{s.value.disconnect(),n.value.stop(),n.value.video.detach(),n.value=null,o.value&&(o.value.stop(),o.value.video.detach(),o.value=null),l.value=!1,c.value="",t.value=[],window.clearInterval(u.value),u.value=-1,g.Z.signOut()},C=async()=>{o.value=await g.Z.createLocalScreen({audio:!0,video:!0}),o.value.video.setExtraValue("screen");const e=o.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),s.value.publish([o.value])},b=async()=>{o.value.video.detach(),o.value.stop(),s.value.unpublish([o.value]),o.value=void 0};return{userInfo:r,confName:e,conf:s,localMedia:n,localScreen:o,remoteParticipants:t,isConnected:l,myId:c,cameraDevices:i,audioCheckInterval:u,onConnect:m,onProvisioning:p,onCreateLocalMedia:h,onCreateLocalScreen:C,onCreateConference:w,onDisConnectConference:f,onDestroyLocalScreen:b}}},C=n(83744);const b=(0,C.Z)(f,[["render",m],["__scopeId","data-v-3711e481"]]);var k=b},98672:function(e,s,n){n.r(s),n.d(s,{default:function(){return Pe}});var a=n(66252),o=n(3577),t=n(49963);const l={class:"kb-cloud",id:"kb-cloud"},c={class:"cloud-container",id:"cloud-now"},i={class:"cloud-wrapper"},u={class:"cloud-header"},r={class:"header-column header-title"},d=(0,a._)("h2",{class:"title"},"클라우드",-1),v=[d],p=(0,a._)("div",{class:"badge-on"},"ON",-1),m=(0,a._)("div",{class:"header-column header-subtitle"},null,-1),h={class:"header-column header-util"},w=(0,a._)("div",{class:"util-status"},null,-1),g={class:"util-my"},_={class:"text"},y={class:"my-avatar"},f={class:"cloud-body"},C={class:"cloud-player"},b={class:"player-main"},k={class:"main-viewport"},I={class:"viewport-header"},S={class:"header-column header-views"},T=(0,a._)("i",{class:"icon-eye"},null,-1),H={class:"text"},N=(0,a._)("div",{class:"header-column header-actions"},[(0,a._)("button",{class:"btn-viewport"},[(0,a._)("i",{class:"icon-viewport"})])],-1),D={class:"viewport-video"},L={key:2,src:"https://zep.us/play/8jd49y",width:"100%",height:"584px"},x={class:"main-actions"},M={key:0,class:"menu-buttons"},P={class:"menu-list"},Z=(0,a._)("i",{class:"icon-menu-lecture"},null,-1),j=(0,a._)("span",{class:"text"},"강의",-1),q=[Z,j],z=(0,a.uE)('<div class="dropdown-target"><div class="dropdown-box"><article class="dropdown-option-group"><h4 class="option-group-title">학습관리</h4><ul class="dropdown-option-list"><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습시작</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">휴식시작</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">휴식종료</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료 취소</a></li><li class="dropdown-option-item"><a href="" class="dropdown-option-link">학습종료 확인</a></li></ul></article></div></div>',1),F=(0,a._)("i",{class:"icon-menu-display"},null,-1),U=(0,a._)("span",{class:"text"},"방송",-1),V=[F,U],A=(0,a._)("i",{class:"icon-menu-display"},null,-1),E=(0,a._)("span",{class:"text"},"화상",-1),Q=[A,E],K=(0,a._)("i",{class:"icon-menu-attendance"},null,-1),R=(0,a._)("span",{class:"text"},"ZEP",-1),O=[K,R],Y=(0,a.uE)('<li class="menu-item"><button class="btn-menu"><i class="icon-menu-attendance"></i><span class="text">출석</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-quiz"></i><span class="text">퀴즈・투표</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-event"></i><span class="text">이벤트・쿠폰</span></button></li><li class="menu-item"><button class="btn-menu"><i class="icon-menu-qna"></i><span class="text">Q&amp;A・공지</span></button></li>',4),B={class:"action-buttons"},J=(0,a._)("i",{class:"icon-reconnect"},null,-1),$=(0,a._)("span",{class:"text"},"재접속",-1),G=[J,$],W=(0,a._)("i",{class:"icon-exit"},null,-1),X=(0,a._)("span",{class:"text"},"종료",-1),ee=[W,X],se={class:"player-aside"},ne={class:"aside-chat-container"},ae={class:"chat-screen"},oe={class:"chat-screen-messages"},te={class:"chat-write"},le={class:"chat-write-options"},ce=(0,a.uE)('<div class="option-column"><button class="btn-emoji"><i class="icon-emoji"></i></button><button class="btn-file"><i class="icon-file"></i></button></div>',1),ie={key:0,class:"option-column"},ue=(0,a._)("i",{class:"icon-menu"},null,-1),re=[ue],de={class:"dropdown-target"},ve={class:"dropdown-box"},pe={class:"dropdown-option-list"},me={class:"dropdown-option-item"},he={class:"chat-write-forms"},we=(0,a._)("span",{class:"text"},"전송",-1),ge=[we];function _e(e,s,n,d,Z,j){const F=(0,a.up)("ChatProfileImage"),U=(0,a.up)("CloudNowTeacherQuestion"),A=(0,a.up)("LiveCast"),E=(0,a.up)("LiveConference"),K=(0,a.up)("ChatMessage");return(0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",c,[(0,a._)("div",i,[(0,a._)("header",u,[(0,a._)("div",r,[(0,a._)("a",{href:"javascript:",onClick:s[0]||(s[0]=(...e)=>d.menuCompHideFunc&&d.menuCompHideFunc(...e))},v),p]),m,(0,a._)("div",h,[w,(0,a._)("div",g,[(0,a._)("span",_,(0,o.zw)(d.userInfo.lrnerNm),1),(0,a._)("div",y,[(0,a.Wm)(F,{target:d.userInfo.lrnerId},null,8,["target"])])])])]),(0,a._)("div",f,[d.showTeacherQstnComp?((0,a.wg)(),(0,a.j4)(U,{key:0})):(0,a.kq)("",!0),(0,a._)("div",C,[(0,a._)("div",b,[(0,a._)("div",k,[(0,a._)("div",I,[(0,a._)("div",S,[T,(0,a._)("span",H,(0,o.zw)(d.connUserCnt),1)]),N]),(0,a._)("div",D,[d.isLiveCastShow?((0,a.wg)(),(0,a.j4)(A,{key:0,"access-type":d.userInfo.accessType,"user-info":d.userInfo},null,8,["access-type","user-info"])):(0,a.kq)("",!0),d.onLiveConfShow?((0,a.wg)(),(0,a.j4)(E,{key:1,style:(0,o.j5)(""+(d.isLiveConfShow?"display:block;":"display:none;")),"access-type":d.userInfo.accessType,"user-info":d.userInfo},null,8,["style","access-type","user-info"])):(0,a.kq)("",!0),d.isIframeShow?((0,a.wg)(),(0,a.iD)("iframe",L)):(0,a.kq)("",!0)])]),(0,a._)("div",x,["full-access"===d.userInfo.accessType?((0,a.wg)(),(0,a.iD)("div",M,[(0,a._)("ul",P,[(0,a._)("li",{class:(0,o.C_)(["menu-item dropdown",{"is-active":d.showLectureMenu}])},[(0,a._)("button",{class:(0,o.C_)(["btn-menu",{"is-active":d.showLectureMenu}]),onClick:s[1]||(s[1]=e=>d.toggleMenu("lecture"))},q,2),z],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isLiveCastShow?"is-active":""))},[(0,a._)("button",{onClick:s[2]||(s[2]=e=>d.connectCastFunc("cast")),class:"btn-menu"},V)],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isLiveConfShow?"is-active":""))},[(0,a._)("button",{onClick:s[3]||(s[3]=e=>d.connectCastFunc("conf")),class:"btn-menu"},Q)],2),(0,a._)("li",{class:(0,o.C_)("menu-item "+(d.isIframeShow?"is-active":""))},[(0,a._)("button",{onClick:s[4]||(s[4]=e=>d.connectCastFunc("zep")),class:"btn-menu"},O)],2),Y])])):(0,a.kq)("",!0),(0,a._)("div",B,[(0,a._)("button",{class:"btn-reconnect",onClick:s[5]||(s[5]=(...e)=>d.sendConnect&&d.sendConnect(...e))},G),(0,a._)("button",{class:"btn-exit",onClick:s[6]||(s[6]=(...e)=>d.sendDisconnect&&d.sendDisconnect(...e))},ee)])])]),(0,a._)("div",se,[(0,a._)("div",ne,[(0,a._)("div",ae,[(0,a._)("ul",oe,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.msgArr,((e,s)=>((0,a.wg)(),(0,a.j4)(K,{key:s,type:e.type,message:e.message,"lrner-id":e.lrnerId,"lrner-name":e.lrnerNm,"send-date":e.sendDate},null,8,["type","message","lrner-id","lrner-name","send-date"])))),128))])]),(0,a._)("div",te,[(0,a._)("div",le,[ce,"full-access"!==d.userInfo.accessType?((0,a.wg)(),(0,a.iD)("div",ie,[(0,a._)("div",{class:(0,o.C_)(["option-menu dropdown",{"is-active":d.showTeacherQstnMenu}])},[(0,a._)("button",{class:"btn-menu",onClick:s[7]||(s[7]=e=>d.toggleMenu("teacher"))},re),(0,a._)("div",de,[(0,a._)("div",ve,[(0,a._)("ul",pe,[(0,a._)("li",me,[(0,a._)("a",{href:"javascript:",onClick:s[8]||(s[8]=(...e)=>d.showTeacherQstnCompFunc&&d.showTeacherQstnCompFunc(...e)),class:"dropdown-option-link"},"강사님께 질문하기")])])])])],2)])):(0,a.kq)("",!0)]),(0,a._)("div",he,[(0,a.wy)((0,a._)("input",{type:"text",placeholder:"메시지 입력","onUpdate:modelValue":s[9]||(s[9]=e=>d.inputMessage=e),onKeyup:s[10]||(s[10]=(0,t.D2)(((...e)=>d.sendMessage&&d.sendMessage(...e)),["enter"]))},null,544),[[t.nr,d.inputMessage]]),(0,a._)("button",{class:"btn-write",onClick:s[11]||(s[11]=(...e)=>d.sendMessage&&d.sendMessage(...e))},ge)])])])])])])])])])}n(82801);var ye=n(2262),fe=n(9367),Ce=n(33907),be=n(6315),ke=n(42119),Ie=n(4252),Se=n(54977),Te=n(64761),He=n(89464),Ne=n(80703),De=n(47528),Le={name:"CloudNow",components:{LiveConference:De["default"],CloudNowTeacherQuestion:Ne.Z,LiveCast:He.Z,ChatProfileImage:Te.Z,ChatMessage:Ie.Z},setup(){const e=(0,Ce.oR)();let s="";s="localhost:3000";let n=(0,fe.ZP)(s,{transports:["websocket"],path:"/websocket/chat"}),o=(0,fe.ZP)(s,{transports:["websocket"],path:"/websocket/system"});const t=(0,ye.iH)(),l=(0,ye.iH)([]),c=(0,ye.iH)(!1),i=(0,ye.iH)(!1),u=(0,ye.iH)(!1),r=(0,ye.iH)(!1),d=(0,ye.iH)(!1),v=(0,ye.iH)(!1),p=(0,ye.iH)(!1),m=(0,ye.iH)({}),h=(0,ye.iH)(0);(0,a.bv)((()=>{document.body.classList.add("notscroll"),T.query.params?g():console.log("재접속 해주세요.")})),(0,a.Ah)((()=>{(n.connected||o.connected)&&(n.disconnect(),o.disconnect()),r.value=!1,v.value=!1,d.value=!1}));const w=()=>{m.value.sendType="",m.value.message="",m.value.messageType="",m.value.socketId="",m.value.socketId2="",m.value.channelNo="channel-now-chat",m.value.accessType="viewer","S017330"===m.value.lrnerId&&(m.value.accessType="full-access"),m.value.isCast=!1,m.value.isConf=!1,n.emit("chat_channel_connection",m.value),o.emit("domSocket_channel_connection",m.value)},g=()=>{m.value=JSON.parse(decodeURIComponent(atob(T.query.params))),w()},_=()=>{void 0!==t.value&&""!==t.value&&(m.value.sendType="message",m.value.message=t.value,t.value="",n.emit("message",m.value))},y=()=>{console.log("sendDisconnect =======> "),m.value.sendType="disconnect",r.value=!1,v.value=!1,d.value=!1,n.disconnect(),o.disconnect()};n.on("chat_channel_connection",(e=>{console.log("chat connection success ========> ",e),m.value.socketId=e.socketId;let s=e.lrnerNm,n=s+"님이 현재 참여하셨습니다.",a=(0,Se.KG)(e.connectDate,"(A) hh:mm");l.value.push({type:"",message:n,lrnerId:e.lrnerId,lrnerNm:s,sendDate:a}),I()})),n.on("message",(e=>{console.log("chat messsage===>",e);let s="",n=e.lrnerNm;e.lrnerId===m.value.lrnerId&&(s="my",n="");let a=(0,Se.KG)(e.connectDate,"(A) hh:mm");l.value.push({type:s,message:e.message,lrnerId:e.lrnerId,lrnerNm:n,sendDate:a})})),n.on("disconnect",(e=>{console.log("disconnect ========> ",e),I()})),n.on("disconnectCustom",(e=>{console.log("disconnectCustom ========> ",e)})),o.on("domSocket_channel_connection",(e=>{console.log("domSocket connection success ========> ",e.socketId2),m.value.socketId2=e.socketId2})),o.on("disconnect",(()=>{console.log("domSocket disconnect ========> ")})),o.on("disconnectCustom",(()=>{console.log("domSocket disconnectCustom ========> ")})),o.on("message",(e=>{if(console.log("domSocket message ========> ",e.messageType),"liveCast"===e.messageType)r.value?r.value=!1:r.value=!0;else if("liveConf"===e.messageType){let e=btoa(encodeURIComponent(JSON.stringify(m.value)));window.open("/cloud/conf?params="+e,"","width=1280, height=800","_blank")}else"zep"===e.messageType&&(p.value?p.value=!1:p.value=!0)}));const f=e=>{m.value.sendType="message","cast"===e?(m.value.messageType="liveCast",o.emit("message",m.value)):"conf"===e?(m.value.messageType="liveConf",o.emit("message",m.value)):"zep"===e&&(m.value.messageType="zep",o.emit("message",m.value))},C=e=>{"lecture"===e?c.value=!c.value:"teacher"===e&&(i.value=!i.value)},b=()=>{u.value=!u.value},k=()=>{c.value=!1,i.value=!1,u.value=!1},I=()=>{e.dispatch(`users/${be.qU}`,m.value.channelNo).then((e=>{console.log("getRedisUsersList====>",e),200===e.status&&console.log("status 200 ==> ",h.value)})).catch((e=>{console.error(e)}))},S=()=>{e.dispatch(`users/${be.lr}`,localStorage.getItem("info")).then((e=>{e.status})).catch((e=>{console.error(e)}))},T=(0,ke.yj)(),H=()=>{e.dispatch(`users/${be.Zv}`,{accTy:"admin",userSn:"65795",lrnerId:"S017347",lrnerNm:"김상민",deptCd:"",deptNm:""}).then((e=>{200===e.status&&(T.params.encrypt=e.data)})).catch((e=>{console.error(e),alert("창을 닫고 재접속 해주세요.")}))};return{inputMessage:t,userInfo:m,msgArr:l,isLiveCastShow:r,onLiveConfShow:d,isLiveConfShow:v,isIframeShow:p,showLectureMenu:c,showTeacherQstnMenu:i,showTeacherQstnComp:u,connUserCnt:h,sendConnect:g,sendMessage:_,sendDisconnect:y,getUsersEncryptFunc:H,getUsersDecryptFunc:S,getRedisUsersList:I,connectCastFunc:f,showTeacherQstnCompFunc:b,toggleMenu:C,menuCompHideFunc:k}}},xe=n(83744);const Me=(0,xe.Z)(Le,[["render",_e]]);var Pe=Me}}]);
//# sourceMappingURL=672.e3831a34.js.map