"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[857],{49729:function(e,a,n){n.r(a),n.d(a,{default:function(){return N}});var i=n(66252),o=n(3577);const t=e=>((0,i.dD)("data-v-08936fd9"),e=e(),(0,i.Cn)(),e),l={class:"container flex column"},c={class:"flex row"},r={class:"media-list"},s={key:0,class:"media-block"},d={class:"participant-id"},u=t((()=>(0,i._)("div",{class:"local-container"},null,-1))),v=["id"],p={class:"participant-id"};function m(e,a,n,t,m,f){const w=(0,i.up)("voice-meter"),h=(0,i.up)("remote-video");return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",c,[(0,i._)("div",r,[t.localMedia?((0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("div",d,(0,o.zw)(n.userInfo.deptNm)+" "+(0,o.zw)(n.userInfo.lrnerNm)+" "+(0,o.zw)(t.myId),1),u])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.remoteParticipants,((e,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"media-block",key:a,id:e.participant.id},[(0,i._)("div",p,(0,o.zw)(e.participant.lrnerNm)+" "+(0,o.zw)(e.participant.id),1),(0,i.Wm)(w,{level:e.level},null,8,["level"]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.videos,((e,a)=>((0,i.wg)(),(0,i.j4)(h,{key:a,autoplay:"",remoteVideo:e},null,8,["remoteVideo"])))),128))],8,v)))),128))])])])}var f=n(69755),w=n(17672),h=n(19832),y=n(2262),I=n(9367),C={name:"LiveConference",props:{accessType:String,userInfo:{type:Object}},components:{voiceMeter:f.Z,remoteVideo:w.Z},setup(e){const a=(0,y.iH)(e.userInfo.channelNo+"-conf"),n=(0,y.iH)(null),o=(0,y.iH)(null),t=(0,y.iH)(null),l=(0,y.iH)([]),c=(0,y.iH)(!1),r=(0,y.iH)(""),s=(0,y.iH)([]),d=(0,y.iH)(-1);let u="localhost:3000",v=(0,I.ZP)(u,{transports:["websocket"],path:"/websocket/system"});const p=()=>{console.log(n.value,"init====>",e.userInfo),null===n.value&&("full-access"===e.accessType?f():setTimeout((()=>{f()}),3e3))};(0,i.bv)((()=>{console.log("mounted===>",n.value),p()})),(0,i.Ah)((()=>{g()}));const m=async()=>{await h.Z.signIn({serviceId:"2022KBH0C8AZ",serviceKey:"2022KBH0C8AZ42PO",secret:"w7kvrnnCNVjBzjdR"})},f=async()=>{await m(),await w(),await C(),await n.value.connect(a.value),r.value=n.value.localParticipant.id,c.value=!0,n.value.publish([o.value]);let i={lrnerNm:e.userInfo.lrnerNm,participantId:n.value.localParticipant.id,confName:a.value,channelNo:e.userInfo.channelNo,dateType:"conf"};v.emit("nowConfAddUser",i),d.value=window.setInterval((()=>{const e=n.value.getRemoteAudioLevels();e.remoteParticipants.forEach((e=>{const a=l.value.find((a=>a.participant.id===e.remoteParticipant.id));let n=parseFloat(e.level.toFixed(3));n>.15&&(n=.15),a.level=n/.15*100}))}),250)};v.on("nowConfAddUser",(e=>{console.log("nowConfAddUser;;;;",e),l.value.forEach((a=>{console.log("participant;;;;",a),a.id===e.participantId&&(a.lrnerNm=e.lrnerNm)}))}));const w=async()=>{o.value=await h.Z.createLocalMedia({audio:!0,video:!0}),console.log(n.value),(0,i.Y3)((async()=>{const e=o.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),s.value=await o.value.getCameraDevices()}))},C=async()=>{n.value=h.Z.createConference(),n.value.on("connected",(e=>{e.remoteParticipants.forEach((async e=>{let a=[];const i=e.getUnsubscribedVideos();if(i.length){const e=i.map((e=>{e.getVideoId()}));a=await n.value.subscribe(e)}console.log("connected;;;;",e),l.value.push({participant:e,videos:a,level:0})}))})),n.value.on("participantEntered",(e=>{l.value.push({participant:e.remoteParticipant,videos:[],level:0})})),n.value.on("participantLeft",(e=>{const a=l.value.findIndex((a=>a.participant.id===e.remoteParticipantId));l.value.splice(a,1)})),n.value.on("remoteVideoPublished",(async a=>{const i=await n.value.subscribe([a.remoteVideo.videoId]);if(i.length){const n=l.value.find((e=>e.participant.id===a.remoteParticipant.id));n&&(n.videos=n.videos.concat(i),n.lrnerNm=e.userInfo.lrnerNm)}})),n.value.on("remoteVideoUnpublished",(e=>{const a=l.value.find((a=>a.participant.id===e.remoteParticipant.id));a&&(a.videos=a.videos.filter((a=>a.videoId!==e.remoteVideo.videoId)))}))},g=async()=>{n.value.disconnect(),o.value.stop(),o.value.video.detach(),o.value=null,t.value&&(t.value.stop(),t.value.video.detach(),t.value=null),c.value=!1,r.value="",l.value=[],window.clearInterval(d.value),d.value=-1,h.Z.signOut()},b=async()=>{t.value=await h.Z.createLocalScreen({audio:!0,video:!0}),t.value.video.setExtraValue("screen");const e=t.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),n.value.publish([t.value])},N=async()=>{t.value.video.detach(),t.value.stop(),n.value.unpublish([t.value]),t.value=void 0};return{confName:a,conf:n,localMedia:o,localScreen:t,remoteParticipants:l,isConnected:c,myId:r,cameraDevices:s,audioCheckInterval:d,onConnect:f,onProvisioning:m,onCreateLocalMedia:w,onCreateLocalScreen:b,onCreateConference:C,onDisConnectConference:g,onDestroyLocalScreen:N}}},g=n(83744);const b=(0,g.Z)(C,[["render",m],["__scopeId","data-v-08936fd9"]]);var N=b}}]);
//# sourceMappingURL=857.96fb1001.js.map