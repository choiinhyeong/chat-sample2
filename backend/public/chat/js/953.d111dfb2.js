"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[953],{47528:function(e,a,i){i.r(a),i.d(a,{default:function(){return P}});var t=i(66252),l=i(3577);const n=e=>((0,t.dD)("data-v-3711e481"),e=e(),(0,t.Cn)(),e),o={class:"container flex column"},c={class:"flex row"},r={class:"media-list"},s={key:0,class:"media-block"},u={class:"participant-id"},v=n((()=>(0,t._)("div",{class:"local-container"},null,-1))),d=["id"],p={class:"participant-id"};function m(e,a,i,n,m,f){const w=(0,t.up)("voice-meter"),h=(0,t.up)("remote-video");return(0,t.wg)(),(0,t.iD)("div",o,[(0,t._)("div",c,[(0,t._)("div",r,[n.localMedia?((0,t.wg)(),(0,t.iD)("div",s,[(0,t._)("div",u,(0,l.zw)(n.userInfo.deptNm)+" "+(0,l.zw)(n.userInfo.lrnerNm)+" "+(0,l.zw)(n.myId),1),v])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.remoteParticipants,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"media-block",key:a,id:e.participant.id},[(0,t._)("div",p,(0,l.zw)(e.participant.lrnerNm)+" "+(0,l.zw)(e.participant.id),1),(0,t.Wm)(w,{level:e.level},null,8,["level"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.videos,((e,a)=>((0,t.wg)(),(0,t.j4)(h,{key:a,autoplay:"",controls:"",remoteVideo:e},null,8,["remoteVideo"])))),128))],8,d)))),128))])])])}i(82801);var f=i(69755),w=i(94572),h=i(19832),y=i(2262),C=i(42119),g={name:"LiveConference",components:{voiceMeter:f.Z,remoteVideo:w.Z},setup(){const e=(0,y.iH)(),a=(0,y.iH)(null),i=(0,y.iH)(null),l=(0,y.iH)(null),n=(0,y.iH)([]),o=(0,y.iH)(!1),c=(0,y.iH)(""),r=(0,y.iH)([]),s=(0,y.iH)(-1),u=(0,y.iH)({}),v=(0,C.yj)(),d=()=>{u.value=JSON.parse(decodeURIComponent(atob(v.query.params))),e.value=u.value.channelNo+"conf",null===a.value&&("full-access"===u.value.accessType?m():setTimeout((()=>{m()}),3e3))};(0,t.bv)((()=>{console.log("mounted===>",a.value),d()})),(0,t.Ah)((()=>{g()}));const p=async()=>{await h.Z.signIn({serviceId:"2022KBH0C8AZ",serviceKey:"2022KBH0C8AZ42PO",secret:"w7kvrnnCNVjBzjdR"})},m=async()=>{await p(),await f(),await w(),await a.value.connect(e.value),c.value=a.value.localParticipant.id,o.value=!0,a.value.publish([i.value]),s.value=window.setInterval((()=>{const e=a.value.getRemoteAudioLevels();e.remoteParticipants.forEach((e=>{const a=n.value.find((a=>a.participant.id===e.remoteParticipant.id));let i=parseFloat(e.level.toFixed(3));i>.15&&(i=.15),a.level=i/.15*100}))}),250)},f=async()=>{i.value=await h.Z.createLocalMedia({audio:!0,video:!0}),console.log(a.value),(0,t.Y3)((async()=>{const e=i.value.video.attach();e.className="local-video",e.style.width="100%",e.muted=!0,e.autoplay=!0,e.controls=!0,document.querySelector(".local-container").appendChild(e),r.value=await i.value.getCameraDevices()}))},w=async()=>{a.value=h.Z.createConference(),a.value.on("connected",(e=>{e.remoteParticipants.forEach((async e=>{let i=[];const t=e.getUnsubscribedVideos();if(t.length){const e=t.map((e=>{e.getVideoId()}));i=await a.value.subscribe(e)}n.value.push({participant:e,videos:i,level:0}),console.log("connected participant;;;;",e),console.log("connected remoteParticipants;;;;",n.value)}))})),a.value.on("participantEntered",(e=>{n.value.push({participant:e.remoteParticipant,videos:[],level:0}),console.log("participantEntered remoteParticipants;;;;",n.value)})),a.value.on("participantLeft",(e=>{const a=n.value.findIndex((a=>a.participant.id===e.remoteParticipantId));n.value.splice(a,1)})),a.value.on("remoteVideoPublished",(async e=>{const i=await a.value.subscribe([e.remoteVideo.videoId]);if(i.length){const a=n.value.find((a=>a.participant.id===e.remoteParticipant.id));a&&(a.videos=a.videos.concat(i),a.lrnerNm=u.value.lrnerNm)}})),a.value.on("remoteVideoUnpublished",(e=>{const a=n.value.find((a=>a.participant.id===e.remoteParticipant.id));a&&(a.videos=a.videos.filter((a=>a.videoId!==e.remoteVideo.videoId)))}))},g=async()=>{a.value.disconnect(),i.value.stop(),i.value.video.detach(),i.value=null,l.value&&(l.value.stop(),l.value.video.detach(),l.value=null),o.value=!1,c.value="",n.value=[],window.clearInterval(s.value),s.value=-1,h.Z.signOut()},I=async()=>{l.value=await h.Z.createLocalScreen({audio:!0,video:!0}),l.value.video.setExtraValue("screen");const e=l.value.video.attach();e.className="local-video",e.style.width="100%",document.querySelector(".local-container").appendChild(e),a.value.publish([l.value])},b=async()=>{l.value.video.detach(),l.value.stop(),a.value.unpublish([l.value]),l.value=void 0};return{userInfo:u,confName:e,conf:a,localMedia:i,localScreen:l,remoteParticipants:n,isConnected:o,myId:c,cameraDevices:r,audioCheckInterval:s,onConnect:m,onProvisioning:p,onCreateLocalMedia:f,onCreateLocalScreen:I,onCreateConference:w,onDisConnectConference:g,onDestroyLocalScreen:b}}},I=i(83744);const b=(0,I.Z)(g,[["render",m],["__scopeId","data-v-3711e481"]]);var P=b}}]);
//# sourceMappingURL=953.d111dfb2.js.map